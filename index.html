<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/radar-chart.css">
        <link rel="stylesheet" href="css/main.css">
        <style>
          /* <![CDATA[ */
            body {
              padding: 1.5em;
              padding-bottom: calc(1.5em + 50px);
            }

            thead td {
              text-align: center;
            }

            .series {
              border-right: none !important;

              vertical-align: middle !important;
            }

            .learning-objective {
              border-left: none !important;
            }

            td:not(.learning-objective) input.form-control {
              max-width: 4em;
            }

            .navbar .navbar-right:last-child {
              margin-right: 0;
            }
          /* ]]> */
        </style>
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div class="container-fluid">
          <div class="row">
            <div id="chart" class="col-md-6"></div>
            <div id="data" class="col-md-6">
              <table id="data-table" class="table table-bordered table-hover">
                <thead>
                  <tr>
                    <td colspan="2">Learning Objective</td>
                    <td>Authority is constructed and contextual</td>
                    <td>Information creation as a process</td>
                    <td>Information has value</td>
                    <td>Research as inquiry</td>
                    <td>Scholarship as conversation</td>
                    <td>Searching as strategic exploration</td>
                  </tr>
                </thead>
                <tbody class="form-inline"></tbody>
              </table>
            </div>
          </div>
        </div>

        <nav class="navbar navbar-default navbar-fixed-bottom">
          <div class="container-fluid">
            <p id="permalink-container" class="navbar-text navbar-right"></p>
          </div>
        </nav>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.3.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script src="bower_components/d3/d3.min.js"></script>
        <script src="js/radar-chart.js"></script>
        <script src="js/main.js"></script>
        <script>
          /* <![CDATA[ */
            // Set up data.
            var data = {
              axes: [
                'Authority is constructed and contextual',
                'Information creation as a process',
                'Information has value',
                'Research as inquiry',
                'Scholarship as conversation',
                'Searching as strategic exploration'
              ]
            };

            var defaultData = [
              {
                className: 'Introductory Activity',
                values: [2, 2.67, 2, 4, 1.67, 4]
              },
              {
                className: 'Online Tutorial',
                values: [4, 4.33, 2.33, 2, 2.33, 4]
              },
              {
                className: 'Core 100 (Academic Integrity session)',
                values: [3, 2, 3.67, 2.67, 4.67, 1]
              },
              {
                className: 'Core 100 (Library session)',
                values: [4, 4.67, 2, 3.33, 2.33, 4.33]
              },
              {
                className: 'Core 100 (Library assignment)',
                values: [4, 3, 3.67, 4.33, 4.33, 4.33]
              },
              {
                className: 'First Year Writing Courses',
                values: [3.5, 2, 5, 2.33, 2.33, 3.67]
              },
              {
                className: 'Core Perspective Courses',
                values: [4.33, 2.67, 3, 3.67, 4.67, 4.67]
              }
            ];

            // Try pulling data from the URL.
            try {
              var queryString = window.location.href.match(/\?data=([^?/]+)\/?$/);

              if (queryString) {
                queryString = queryString[1];
              }

              data.data = JSON.parse(decodeURIComponent(queryString));
            } finally {
              if (!data.data) {
                data.data = defaultData;
              }
            }

            // Add permalink
            function updatePermalink(permalink, data) {
              permalink.attr('href', window.location.href.replace(/\?[^?]*$/, '') + '?data=' + encodeURIComponent(JSON.stringify(data)));
            }

            var permalink = $(document.createElement('a')).addClass('navbar-link').text('permalink');

            $('#permalink-container').append(permalink);

            updatePermalink(permalink, data.data);

            // Fill table
            var table = $('#data-table tbody');

            for (var datumIndex = 0, dataLength = data.data.length; datumIndex < dataLength; datumIndex++) {
              var row = $(document.createElement('tr')),
                  loCell, loInput;

              row.append($(document.createElement('td')).addClass('series'));

              loCell = $(document.createElement('td')).addClass('learning-objective');
              loInput = $(document.createElement('input')).addClass('form-control').val(data.data[datumIndex].className).data({ type: 'objective', value: { learningObjective: datumIndex } });

              loCell.append(loInput);
              row.append(loCell);

              for (var valueIndex = 0, valueLength = data.data[datumIndex].values.length; valueIndex < valueLength; valueIndex++) {
                var cell = $(document.createElement('td')),
                    input = $(document.createElement('input')).addClass('form-control').val(data.data[datumIndex].values[valueIndex]).data({ type: 'value', value: { learningObjective: datumIndex, frame: valueIndex } });

                cell.append(input);
                row.append(cell);
              }

              table.append(row)
            }

            $('#data-table').on('change', 'input', function(event) {
              var item = $(event.target).data(),
                  value = $(event.target).val();

              if (item.type === 'objective') {
                if (data.data[item.value.learningObjective]) {
                  data.data[item.value.learningObjective].className = value;
                }
              } else if (item.type === 'value') {
                if (data.data[item.value.learningObjective] && data.data[item.value.learningObjective].values) {
                  data.data[item.value.learningObjective].values[item.value.frame] = parseFloat(value);
                }
              }

              chart.update(data.data);
              updatePermalink(permalink, data.data);
            });

            // Make chart
            var svg = d3.select('#chart').append('svg')
            .attr('width', "100%")
            .attr('height', 600);

            config = {
              width: $('#chart svg').innerWidth(),
              levels: 5,
              sublevels: 3,
              maxValue: 5
            };

            var chart = new RadarChart(svg, data, config);

            // Add series markers to table.
            var series = d3.selectAll('.series').data(d3.range(0, data.data.length));

            series.each(function(d, i) {
              var svg = d3.select(this).append('svg');

              svg
              .attr('width', 20)
              .attr('height', 20);

              svg.append('path')
              .classed('circle', 1);
            });

            d3.select('#data-table').selectAll('.circle').each(function(d) {
              var classed = { 'radar-chart-series': 1 };
              classed['radar-chart-series-' + d] = 1;
              d3.select(this).classed(classed);
            })
            .attr('d', d3.svg.symbol().type(function(d, i) {
              return d3.svg.symbolTypes[d % d3.svg.symbolTypes.length];
            }))
            .attr('transform', 'translate(10, 10)');
          /* ]]> */
        </script>
    </body>
</html>
